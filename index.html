
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∞–∑–∏–Ω —Å–≤–µ—á–µ–π</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f6f6f6; }
    .nav { display: flex; justify-content: space-around; background: #fff; border-top: 1px solid #ccc; position: fixed; bottom: 0; width: 100%; }
    .nav button { flex: 1; padding: 15px; font-size: 16px; background: none; border: none; cursor: pointer; }
    .container { padding: 16px; padding-bottom: 80px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
    .card { background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
    .card img { width: 100%; height: 120px; object-fit: cover; }
    .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
    .card-title { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
    .card-price { font-size: 13px; color: #888; margin-bottom: 8px; }
    .card button, .counter button { background: #007aff; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer; }
    .hidden { display: none; }
    input { margin: 8px 0; padding: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; }
    .cart-line { display: flex; justify-content: space-between; align-items: center; margin: 5px 0; }
    .cart-line button { margin-left: 5px; background: #ccc; color: #333; border: none; padding: 4px 8px; border-radius: 4px; }
    .confirmation, .cart-page { padding: 20px; }
    .confirmation { display: flex; flex-direction: column; align-items: center; text-align: center; }
    .confirmation h2 { font-size: 24px; margin: 20px 0 10px; }
    .confirmation p { font-size: 16px; color: #444; }
    .confirmation button { margin-top: 20px; padding: 10px 20px; background: #007aff; color: white; border: none; border-radius: 6px; font-size: 16px; }
    .counter { display: flex; align-items: center; justify-content: center; gap: 10px; }
    .counter span { font-size: 16px; }
  </style>
</head>
<body>
  <div id="shop" class="container"><div class="grid" id="itemGrid"></div></div>
  <div id="cart" class="container hidden">
    <div class="cart-page">
      <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <div id="cartList"></div>
      <p><strong>–ò—Ç–æ–≥–æ: <span id="total">0‚ÇΩ</span></strong></p>
      <input type="text" id="lastname" placeholder="–§–∞–º–∏–ª–∏—è">
      <input type="text" id="firstname" placeholder="–ò–º—è">
      <input type="text" id="phone" placeholder="+7XXXXXXXXXX">
      <input type="text" id="city" placeholder="–ì–æ—Ä–æ–¥">
      <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å">
      <label><input type="checkbox" id="pickup"> –°–∞–º–æ–≤—ã–≤–æ–∑</label><br>
      <button onclick="checkout()" style="margin-top: 10px;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </div>
  <div id="confirmation" class="container hidden">
    <div class="confirmation">
      <div style="font-size: 64px;">‚úÖ</div>
      <h2>–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑!</h2>
      <p>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.</p>
      <button onclick="goToShop()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω</button>
    </div>
  </div>
  <div class="nav">
    <button onclick="goToShop()">üõç –ú–∞–≥–∞–∑–∏–Ω</button>
    <button onclick="goToCart()">üßæ –ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
  <script>
    Telegram.WebApp.ready();
    const items = [
      { name: "–°–≤–µ—á–∞ –Ω–∞ –¥–µ–Ω—å–≥–∏", price: 500, image: "https://via.placeholder.com/160x120?text=–§–æ—Ç–æ" },
      { name: "–°–≤–µ—á–∞ –Ω–∞ –ª—é–±–æ–≤—å", price: 500, image: "https://raw.githubusercontent.com/KoratunYuri/candle-store/main/love.png" },
      { name: "–°–≤–µ—á–∞ –Ω–∞ –æ—á–∏—â–µ–Ω–∏–µ", price: 500, image: "https://via.placeholder.com/160x120?text=–§–æ—Ç–æ" },
      { name: "–°–≤–µ—á–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è", price: 450, image: "https://via.placeholder.com/160x120?text=–§–æ—Ç–æ" }
    ];
    const cart = {};
    const shopDiv = document.getElementById('shop');
    const cartDiv = document.getElementById('cart');
    const confirmationDiv = document.getElementById('confirmation');
    const itemGrid = document.getElementById('itemGrid');
    const cartList = document.getElementById('cartList');
    const totalSpan = document.getElementById('total');
    const TOKEN = '7987338974:AAFGe-sbPh3GFpnyVVv3nWgH9XQsZ2QH4t0';
    const ADMIN_ID = 319994578;

    items.forEach((item, index) => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div class="card-body">
          <div><div class="card-title">${item.name}</div><div class="card-price">${item.price}‚ÇΩ</div></div>
          <div id="control-${index}"><button onclick="addToCart(${index})">üõí –î–æ–±–∞–≤–∏—Ç—å</button></div>
        </div>`;
      itemGrid.appendChild(card);
    });

    function updateCounter(index) {
      const control = document.getElementById(`control-${index}`);
      const item = items[index];
      const quantity = cart[item.name]?.quantity || 0;
      if (quantity === 0) {
        control.innerHTML = `<button onclick="addToCart(${index})">üõí –î–æ–±–∞–≤–∏—Ç—å</button>`;
      } else {
        control.innerHTML = `
          <div class="counter">
            <button onclick="removeFromCart(${index})">‚àí</button>
            <span>${quantity}</span>
            <button onclick="addToCart(${index})">+</button>
          </div>`;
      }
    }

    function addToCart(index) {
      const item = items[index];
      cart[item.name] = cart[item.name] || { price: item.price, quantity: 0 };
      cart[item.name].quantity++;
      updateCounter(index);
      updateCart();
    }

    function removeFromCart(index) {
      const item = items[index];
      if (cart[item.name]) {
        cart[item.name].quantity--;
        if (cart[item.name].quantity <= 0) delete cart[item.name];
        updateCounter(index);
        updateCart();
      }
    }

    function updateCart() {
      cartList.innerHTML = '';
      let total = 0;
      Object.keys(cart).forEach(name => {
        const item = cart[name];
        total += item.price * item.quantity;
        const line = document.createElement('div');
        line.className = 'cart-line';
        line.innerHTML = `
          <span>${name} √ó ${item.quantity} ‚Äî ${item.price * item.quantity}‚ÇΩ</span>
          <span>
            <button onclick="removeFromCart(${items.findIndex(i => i.name === name)})">‚àí</button>
            <button onclick="addToCart(${items.findIndex(i => i.name === name)})">+</button>
            <button onclick="deleteFromCart('${name}')">üóë</button>
          </span>`;
        cartList.appendChild(line);
      });
      totalSpan.textContent = total + '‚ÇΩ';
    }

    function deleteFromCart(name) {
      delete cart[name];
      updateCart();
      const index = items.findIndex(i => i.name === name);
      updateCounter(index);
    }

    function checkout() {
      const lastname = document.getElementById('lastname').value.trim();
      const firstname = document.getElementById('firstname').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const city = document.getElementById('city').value.trim();
      const address = document.getElementById('address').value.trim();
      const pickup = document.getElementById('pickup').checked;
      if (!lastname || !firstname || !phone.startsWith('+7') || phone.length !== 12) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");
        return;
      }
      const itemList = Object.keys(cart).map(name => {
        const item = cart[name];
        return `‚Ä¢ ${name} √ó ${item.quantity} ‚Äî ${item.price * item.quantity}‚ÇΩ`;
      }).join('\n');
      const text = `üì¶ *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑*\n\nüë§ *–§–ò–û:* ${lastname} ${firstname}\nüìû *–¢–µ–ª–µ—Ñ–æ–Ω:* ${phone}\nüìç *–ì–æ—Ä–æ–¥:* ${city}\nüè† *–ê–¥—Ä–µ—Å:* ${pickup ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : address}\nüïØ *–¢–æ–≤–∞—Ä—ã:*\n${itemList}`;
      fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: ADMIN_ID, text, parse_mode: "Markdown" })
      }).then(r => r.json()).then(res => {
        if (res.ok) {
          Object.keys(cart).forEach(name => delete cart[name]);
          items.forEach((_, i) => updateCounter(i));
          updateCart();
          goToConfirmation();
        } else alert("–û—à–∏–±–∫–∞: " + JSON.stringify(res));
      }).catch(err => alert("–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: " + err.message));
    }

    function goToShop() {
      shopDiv.classList.remove('hidden');
      cartDiv.classList.add('hidden');
      confirmationDiv.classList.add('hidden');
    }
    function goToCart() {
      shopDiv.classList.add('hidden');
      cartDiv.classList.remove('hidden');
      confirmationDiv.classList.add('hidden');
    }
    function goToConfirmation() {
      shopDiv.classList.add('hidden');
      cartDiv.classList.add('hidden');
      confirmationDiv.classList.remove('hidden');
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞–≥–∞–∑–∏–Ω —Å–≤–µ—á–µ–π</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fff8f0; }
    h1 { color: #333; }
    .item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button {
      padding: 6px 10px;
      border: none;
      background-color: #d179b9;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    #cart {
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #ccc;
    }
    input {
      margin: 4px 0;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .cart-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
    }
    .controls button {
      margin-left: 5px;
    }
  </style>
</head>
<body>
  <h1>–ú–∞–≥–∞–∑–∏–Ω —Å–≤–µ—á–µ–π</h1>
  <div id="items"></div>

  <div id="cart">
    <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
    <div id="cart-list"></div>
    <div><strong>–ò—Ç–æ–≥–æ: <span id="total">0‚ÇΩ</span></strong></div>
    <div>
      <label>–§–∞–º–∏–ª–∏—è:<br><input type="text" id="lastname" placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è"></label><br>
      <label>–ò–º—è:<br><input type="text" id="firstname" placeholder="–í–∞—à–µ –∏–º—è"></label><br>
      <label>–¢–µ–ª–µ—Ñ–æ–Ω:<br><input type="text" id="phone" placeholder="+7..." pattern="^\\+7\\d{10}$"></label><br>
      <label>–ì–æ—Ä–æ–¥:<br><input type="text" id="city" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –•–∞–±–∞—Ä–æ–≤—Å–∫"></label><br>
      <label>–ê–¥—Ä–µ—Å:<br><input type="text" id="address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"></label><br>
      <label><input type="checkbox" id="pickup"> –°–∞–º–æ–≤—ã–≤–æ–∑</label><br><br>
      <button onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </div>

  <script>
    Telegram.WebApp.ready();
    const BOT_TOKEN = '7987338974:AAFGe-sbPh3GFpnyVVv3nWgH9XQsZ2QH4t0';
    const ADMIN_ID = 319994578;

    const items = [
      { name: "–ù–∞ –¥–µ–Ω—å–≥–∏", price: 500 },
      { name: "–ù–∞ –ª—é–±–æ–≤—å", price: 500 },
      { name: "–ù–∞ –æ—á–∏—â–µ–Ω–∏–µ", price: 500 }
    ];

    const cart = {};
    const itemsDiv = document.getElementById('items');
    const cartList = document.getElementById('cart-list');
    const totalSpan = document.getElementById('total');

    items.forEach((item, i) => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <strong>${item.name}</strong>
        <p>—ç—Ç–∞ —Å–≤–µ—á–∞ –∏–∑–º–µ–Ω–∏—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å</p>
        <p>${item.price}‚ÇΩ</p>
        <button onclick="addToCart(${i})">–ö—É–ø–∏—Ç—å</button>
      `;
      itemsDiv.appendChild(div);
    });

    function addToCart(index) {
      const name = items[index].name;
      if (cart[name]) {
        cart[name].quantity++;
      } else {
        cart[name] = { ...items[index], quantity: 1 };
      }
      updateCart();
    }

    function updateCart() {
      cartList.innerHTML = '';
      let total = 0;

      Object.keys(cart).forEach(name => {
        const item = cart[name];
        total += item.price * item.quantity;

        const div = document.createElement('div');
        div.className = 'cart-line';
        div.innerHTML = `
          <span>${item.name} √ó ${item.quantity} ‚Äî ${item.price * item.quantity}‚ÇΩ</span>
          <span class="controls">
            <button onclick="addToCartByName('${name}')">+</button>
            <button onclick="removeFromCart('${name}')">‚àí</button>
            <button onclick="deleteFromCart('${name}')">üóë</button>
          </span>
        `;
        cartList.appendChild(div);
      });

      totalSpan.textContent = total + '‚ÇΩ';
    }

    function addToCartByName(name) {
      cart[name].quantity++;
      updateCart();
    }

    function removeFromCart(name) {
      if (cart[name].quantity > 1) {
        cart[name].quantity--;
      } else {
        delete cart[name];
      }
      updateCart();
    }

    function deleteFromCart(name) {
      delete cart[name];
      updateCart();
    }

    function checkout() {
      const firstname = document.getElementById('firstname').value.trim();
      const lastname = document.getElementById('lastname').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const city = document.getElementById('city').value.trim();
      const address = document.getElementById('address').value.trim();
      const pickup = document.getElementById('pickup').checked;

      if (!firstname || !lastname || !phone || !phone.startsWith('+7') || phone.length !== 12) {
        alert("‚ùó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –§–ò–û –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω (+7XXXXXXXXXX)");
        return;
      }

      const itemsList = Object.keys(cart).map(name => ({
        name,
        price: cart[name].price,
        quantity: cart[name].quantity
      }));

      const itemListText = itemsList.map(i =>
        `‚Ä¢ ${i.name} √ó ${i.quantity} ‚Äî ${i.price * i.quantity}‚ÇΩ`
      ).join('\\n');

      const text = `üì¶ *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑*\\n\\n` +
                   `üë§ *–§–ò–û:* ${lastname} ${firstname}\\n` +
                   `üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* ${phone}\\n` +
                   `üìç *–ì–æ—Ä–æ–¥:* ${city || "–Ω–µ —É–∫–∞–∑–∞–Ω"}\\n` +
                   `üè† *–ê–¥—Ä–µ—Å:* ${pickup ? "–°–∞–º–æ–≤—ã–≤–æ–∑" : (address || "–Ω–µ —É–∫–∞–∑–∞–Ω")}\\n` +
                   `üïØ *–¢–æ–≤–∞—Ä—ã:*\\n${itemListText}`;

      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: ADMIN_ID,
          text: text,
          parse_mode: "Markdown"
        })
      })
      .then(res => res.json())
      .then(res => {
        if (res.ok) {
          alert("‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
          for (let key in cart) delete cart[key];
          updateCart();
        } else {
          alert("‚ùå –û—à–∏–±–∫–∞ Telegram: " + JSON.stringify(res));
        }
      })
      .catch(err => {
        alert("üö´ –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + err.message);
      });
    }
  </script>
</body>
</html>

